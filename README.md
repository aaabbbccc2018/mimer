# mqtter
A IM tool that use MQTT protocol
### MQTTER 数据包的详细及其修改

1. CONNECT:
	- 固定报头(fixed header):
	    - (1)    +: 0-bit作为脱水标志 [1]:脱水处理(数据包解析按脱水数据包解析);默认是[0]:未脱水
		         +：1~3 bit 标识部分帐户可以在不同的设备同时登录
	    - (1~4)  S: 剩余长度值: MQTT 长度编码
	
	- 可变报头(variable header):
	    - (1)    D 协议名长度,可能为了方便抓包工具的解析，不做D处理
	    - (4)    协议名[MQTT]
	    - (1)    协议版本[4]
	    - (1)    连接标志
	    - (2)    保持链接(max: 18h-12m-15s)
	
	- 有效载荷(payload):	
	    - (16)   M: 客户端ID[IPV6]
	    - (*)    SDM: 遗嘱主题[任意数据类型,推荐字符串]
	    - (*)    SDM: 遗嘱消息[任意数据类型,可以是图片]
	    - (*)    SDM: 用户名[任意数据类型,推荐字符串]
	    - (*)    SDM: 密码[任意数据类型,可以是图片,指纹]

2. CONNACK:
    - 固定报头(fixed header):
        - (1)    +: 0-bit作为脱水标志 [1]:脱水处理(数据包解析按脱水数据包解析);默认是[0]:未脱水	 
        - (1)    D: 剩余长度值: MQTT 长度编码
		
	- 可变报头(variable header):
        - (1)    连接确认标志
        - (1)    连接返回码
		
	- 有效载荷(payload):NULL

3. PUBLISH:
    - 固定报头(fixed header):
		- (1)    +: 0-bit作为脱水标志 [1]:脱水处理(数据包解析按脱水数据包解析);默认是[0]:未脱水	 
	    - (1~4)  S: 剩余长度值: MQTT 长度编码
		
	- 可变报头(variable header):
	    - (*)    SDM: 主题名[任意数据类型,推荐字符串]
		- (1)    报文标识符
		
	- 有效载荷(payload):
	    - (*)    应用消息
		
4. PUBACK:
    - 固定报头(fixed header):
		- (1)    +: 0-bit作为脱水标志 [1]:脱水处理(数据包解析按脱水数据包解析);默认是[0]:未脱水	 
	    - (1)    D: 剩余长度值: MQTT 长度编码
		
	- 可变报头(variable header):
		- (1)    报文标识符
		
	- 有效载荷(payload): NULL
	
5. PUBREC:
    - 固定报头(fixed header):
		- (1)    +: 0-bit作为脱水标志 [1]:脱水处理(数据包解析按脱水数据包解析);默认是[0]:未脱水	 
	    - (1)    D: 剩余长度值: MQTT 长度编码
		
	- 可变报头(variable header):
		- (1)    报文标识符
		
	- 有效载荷(payload): NULL

6. PUBREL:
    - 固定报头(fixed header):
		- (1)    +: 0-bit作为脱水标志 [1]:脱水处理(数据包解析按脱水数据包解析);默认是[0]:未脱水	 
	    - (1)    D: 剩余长度值: MQTT 长度编码
		
	- 可变报头(variable header):
		- (1)    报文标识符
		
	- 有效载荷(payload): NULL

7. PUBCOMP:
    - 固定报头(fixed header):
		- (1)    +: 0-bit作为脱水标志 [1]:脱水处理(数据包解析按脱水数据包解析);默认是[0]:未脱水	 
	    - (1)    D: 剩余长度值: MQTT 长度编码
		
	- 可变报头(variable header):
		- (1)    报文标识符
		
	- 有效载荷(payload): NULL
	
8. SUBSCRIBE:
    - 固定报头(fixed header):
		- (1)    +: 0-bit作为脱水标志 [1]:脱水处理(数据包解析按脱水数据包解析);默认是[0]:未脱水	 
	    - (1~4)  S: 剩余长度值: MQTT 长度编码
		
	- 可变报头(variable header):
	    - (*)    SDM: 主题名[任意数据类型,推荐字符串]
		- (1)    报文标识符
		
	- 有效载荷(payload):
	    - (*)    SDM: 主题名1[任意数据类型,推荐字符串]
		- (1)    M: QOS1
		- (*)    SDM: 主题名2[任意数据类型,推荐字符串]
		- (1)    M: QOS2
		- (*)    SDM: 主题名3[任意数据类型,推荐字符串]
		- (1)    M: QOS3
		- ...

9. SUBACK:
    - 固定报头(fixed header):
		- (1)    +: 0-bit作为脱水标志 [1]:脱水处理(数据包解析按脱水数据包解析);默认是[0]:未脱水	 
	    - (1~4)  S: 剩余长度值: MQTT 长度编码
		
	- 可变报头(variable header):
	    - (1)    报文标识符
		
	- 有效载荷(payload):
	    - (1)    M: QOS1 返回码
	    - (1)    M: QOS2 返回码
	    - (1)    M: QOS3 返回码
		- ...

10. UNSUBSCRIBE:
    - 固定报头(fixed header):
	    - (1)    +: 0-bit作为脱水标志 [1]:脱水处理(数据包解析按脱水数据包解析);默认是[0]:未脱水	 
	    - (1~4)  S: 剩余长度值: MQTT 长度编码
		
	- 可变报头(variable header):
	    - (1)    报文标识符
		
	- 有效载荷(payload):
	    - (*)    SDM: 主题名1[任意数据类型,推荐字符串]
	    - (*)    SDM: 主题名2[任意数据类型,推荐字符串]
	    - (*)    SDM: 主题名3[任意数据类型,推荐字符串]
		- ...

11. UNSUBACK:
    - 固定报头(fixed header):
	    - (1)    +: 0-bit作为脱水标志 [1]:脱水处理(数据包解析按脱水数据包解析);默认是[0]:未脱水	 
	    - (1)    D: 剩余长度值: MQTT 长度编码
		
	- 可变报头(variable header):
	    - (1)    报文标识符
		
	- 有效载荷(payload): NULL

12. PINGREQ:
    - 固定报头(fixed header):
	    - (1)    +: 0-bit作为脱水标志 [1]:脱水处理(数据包解析按脱水数据包解析);默认是[0]:未脱水	 
		         +: 1~3 bit 用于客户端当前状态类型的标志(正在输入/正在处理紧急问题/... ,目前有8种可选类型)
	    - (1)    D: 剩余长度值: MQTT 长度编码
		
	- 可变报头(variable header): NULL
		
	- 有效载荷(payload): NULL
	
13. PINGRESP:
    - 固定报头(fixed header):
	    - (1)    +: 0-bit作为脱水标志 [1]:脱水处理(数据包解析按脱水数据包解析);默认是[0]:未脱水	 		    
	    - (1)    D: 剩余长度值: MQTT 长度编码
		
	- 可变报头(variable header): NULL
		
	- 有效载荷(payload): NULL
	
14. DISCONNECT:
    - 固定报头(fixed header):
	    - (1)    +: 0-bit作为脱水标志 [1]:脱水处理(数据包解析按脱水数据包解析);默认是[0]:未脱水	 		    
	    - (1)    D: 剩余长度值: MQTT 长度编码
		
	- 可变报头(variable header): NULL
		
	- 有效载荷(payload): NULL

### 符号说明:

| 符号|        意义|                 描述          |
|:----:|:----------------|:-------------------------|
| +  | 新增语义(ADD)    |新增MQTT协议的原来没有的语义|
| -  | 删除语义(DELEDE) |删除MQTT中原有的语义|
| M   | 修改语义(MODIFED)|修改或扩展了MQTT协议原有语义|
| D   | 脱水语义(DRIED)  |可执行脱水处理的语义部分|
| S   | 度量语义(SIZE)   |必须有度量前缀的语义部分|

### 一些符号组合的说明

SDM: 表示该部分的语义有前缀SIZE段(此处的脱水方案可以参考MQTT 长度编码方式)，该字段可作脱水处理，且修改了原MQTT协议的原始语义
(?): 每个字段前面的()及数字表示该字段占用的byte，*表示不确定
关于剩余长度的脱水处理
- 长度固定为2的去掉该字段
- 长度为1~4byte的无法做脱水处理
